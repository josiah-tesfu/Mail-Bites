# Mail Bites Chrome Extension Setup

This guide explains how to bootstrap, build, and iterate on the Mail Bites Chrome extension. The current codebase focuses on providing a modular, well-documented foundation that can evolve into the minimalist inbox UI and AI summarization features.

## Requirements
- Node.js 18+ (needed for the build tooling).
- Google Chrome 109 or newer (any Chromium browser with Manifest V3 support works).
- A Gmail account for testing. The extension only activates on `https://mail.google.com/*`.

## Project Layout
```
extension/                # Output consumed by Chrome's "Load unpacked"
├── content-script.js     # Bundled content script (generated by esbuild)
├── content-script.js.map # Source map for easier debugging
├── content.css           # Stylesheet copied from src/content/content.css
└── manifest.json         # Chrome extension manifest (MV3)
src/
└── content/
    ├── app.ts            # High-level coordinator for view handling
    ├── content.css       # Source stylesheet for overlays
    ├── index.ts          # Entry point that bootstraps MailBitesApp
    ├── logger.ts         # Namespaced logging helpers
    ├── navigation.ts     # History API patching and SPA navigation hooks
    └── viewTracker.ts    # Mutation + navigation observer that feeds the app
scripts/
└── build.js              # esbuild driver (bundle JS + copy CSS)
docs/
├── setup.md              # This guide
├── architecture.md       # Architectural decisions and evolution
└── updates.md            # Running log of repository changes
package.json              # npm scripts + dev dependencies
tsconfig.json             # TypeScript settings for editor tooling
```

## First-time setup
1. Install dependencies: `npm install`
2. Produce the extension assets: `npm run build`

The build step bundles `src/content/index.ts` into `extension/content-script.js` and copies the stylesheet into `extension/content.css`. Source maps are emitted to simplify debugging via Chrome DevTools.

## Load the extension in Chrome
1. Open Chrome and navigate to `chrome://extensions`.
2. Enable **Developer mode** (top right toggle).
3. Click **Load unpacked** and select the `extension/` directory in this repository.
4. Open Gmail (any tab at `https://mail.google.com/*`) and reload the page. In DevTools → **Console**, expect a log similar to `"[Mail Bites] Mail Bites ready for rendering."`.

> Tip: Pin the extension icon from Chrome’s toolbar so you can quickly access the “Reload” button while iterating.

## Development workflow
1. Make changes inside `src/content/` (TypeScript) or `src/content/content.css`.
2. Rebuild:
   - Single run: `npm run build`
   - Continuous rebuild: `npm run build:watch`
3. Reload the extension card in `chrome://extensions`.
4. Refresh the Gmail tab to see updates. Source maps allow you to set breakpoints in the original TypeScript files from DevTools.

The `GmailViewTracker` class (documented in `src/content/viewTracker.ts`) combines History API hooks with a MutationObserver to reliably detect inbox, search, and conversation transitions. The `MailBitesApp` class centralizes future UI hooks so new features can extend the existing life cycle predictably.

### Testing commands
- `npm run test:unit` runs Vitest against files in `tests/unit/`, using Chrome API mocks configured in `tests/setup/vitest.setup.ts`.
- `npm run test:integration` launches Playwright (Chromium) with the unpacked extension for end-to-end testing. Ensure `npm run build` has been executed beforehand.

## Next steps / customization hooks
- Minimalist inbox UI: render into `#mail-bites-root` via helpers in `MailBitesApp`.
- Persistent settings: integrate `chrome.storage.sync` or `chrome.storage.local`.
- AI summarization: build on the same view change events to trigger background requests.

Keep `docs/architecture.md` updated as the system grows, and log notable changes in `docs/updates.md` for quick historical context.
